# 无边界白板 (Infinite Whiteboard)

一个轻量级、功能丰富的HTML5白板应用，支持移动端和桌面端，无需安装，即开即用。采用纯前端技术实现，支持本地存储和离线使用。

![无边界白板](./preview.jpg)

## 功能特点

### 基础绘图工具
- **画笔工具**：自由绘制线条，2px默认粗细
- **形状工具**：支持矩形、圆形和直线绘制
- **橡皮擦**：智能擦除，支持不同缩放级别下的精确擦除
- **文本工具**：支持添加文字（最多10字），长按移动，双指缩放
- **撤销功能**：支持撤销最近200次操作
- **清除功能**：一键清空当前画板内容

### 多画板支持
- 提供3个独立画板，内容互不影响
- 点击顶部标签切换画板
- 每个画板支持独立的状态管理

### 高级交互
- **无限画布**：支持缩放(10%-1000%)和平移
- **多指手势**：双指缩放和平移，支持惯性滑动
- **文本编辑**：长按移动，双指缩放，实时预览
- **全屏绘制**：绘制区域覆盖整个屏幕，包括半透明的UI组件下方
- **智能缩放**：保持绘制内容在不同缩放级别下的视觉一致性

### 数据管理
- **本地存储**：使用localStorage保存画板状态
- **历史记录**：支持保存最多3个历史画板
- **自动保存**：保存时自动生成时间戳文件名
- **数据恢复**：支持从历史记录中恢复画板状态

### 其他功能
- **截图保存**：支持将当前画板保存为高质量JPG图片
- **响应式设计**：完美适配各种屏幕尺寸
- **纯前端实现**：无需服务器，完全本地运行
- **离线使用**：支持完全离线运行，无需网络连接

## 技术实现

### 核心技术
- **Canvas API**：使用HTML5 Canvas 2D Context进行绘图
- **原生JavaScript**：无框架依赖，使用ES6+特性
- **CSS3**：使用Flexbox布局，CSS3动画和过渡效果
- **LocalStorage**：使用浏览器本地存储实现数据持久化

### 核心算法
1. **绘图系统**
   - 使用操作队列（Operation Queue）管理绘图状态
   - 实现撤销/重做功能的状态管理
   - 支持多种绘图模式（画笔、形状、文本等）

2. **坐标变换系统**
   - 实现画布坐标系和屏幕坐标系的转换
   - 支持不同缩放级别下的精确绘制
   - 处理触摸事件和鼠标事件的坐标转换

3. **手势识别系统**
   - 实现双指缩放算法
   - 支持平移和缩放的组合操作
   - 处理多点触控事件

4. **文本处理系统**
   - 支持文本的添加、移动和缩放
   - 实现文本在不同缩放级别下的渲染
   - 处理文本编辑的交互逻辑

5. **数据持久化系统**
   - 实现画板状态的序列化和反序列化
   - 管理本地存储空间
   - 处理历史记录的存储和加载

### 性能优化
- 使用Canvas的willReadFrequently属性优化性能
- 实现绘图操作的批量处理
- 优化重绘逻辑，减少不必要的重绘
- 使用事件委托优化事件处理
- 实现触摸事件的防抖和节流

## 如何使用

### 基础操作
1. **画笔使用**
   - 点击画笔工具开始绘制
   - 支持自由绘制线条
   - 自动优化绘制点，提高性能

2. **形状绘制**
   - 点击形状工具选择形状类型
   - 在画布上拖动绘制
   - 支持实时预览

3. **文本编辑**
   - 点击文本工具输入文字
   - 长按可拖动位置
   - 双指捏合可缩放大小
   - 点击确定保存

4. **画板管理**
   - 点击顶部标签切换画板
   - 每个画板独立保存状态
   - 支持清除当前画板

### 高级操作
1. **视图控制**
   - 双指捏合缩放（10%-1000%）
   - 双指滑动平移
   - 点击重置按钮恢复原始视图

2. **数据管理**
   - 点击"更多"保存当前画板
   - 支持保存为JPG图片
   - 查看和加载历史画板
   - 自动管理存储空间

## 技术细节

### 状态管理
```javascript
// 画板状态管理
const states = [[], [], []]; // 三个画板的状态数组
const redoStates = [[], [], []]; // 重做状态数组

// 操作对象结构
const operation = {
    type: 'pen|shape|text|eraser',
    points: [], // 画笔/橡皮擦的点数组
    startPoint: {}, // 形状的起始点
    endPoint: {}, // 形状的结束点
    text: '', // 文本内容
    position: {}, // 文本位置
    scale: 1.0, // 文本缩放
    color: '#333333', // 颜色
    lineWidth: 2 // 线宽
};
```

### 坐标变换
```javascript
// 屏幕坐标转换为画布坐标
function transformPoint(x, y) {
    return {
        x: (x - offsetX) / scale,
        y: (y - offsetY) / scale
    };
}

// 画布坐标转换为屏幕坐标
function inverseTransformPoint(x, y) {
    return {
        x: x * scale + offsetX,
        y: y * scale + offsetY
    };
}
```

### 数据存储
```javascript
// 保存画板状态
const dataToSave = {
    fileName: String,
    timestamp: Number,
    globalTransform: {
        scale: Number,
        offsetX: Number,
        offsetY: Number
    },
    canvasesData: [
        { operations: Array },
        { operations: Array },
        { operations: Array }
    ]
};
```

## 浏览器兼容性

- Chrome (推荐)
- Safari
- Firefox
- Edge

移动设备上效果最佳，支持iOS和Android。

## 开发计划

- [ ] 支持更多形状类型
- [ ] 添加颜色选择器
- [ ] 支持图层管理
- [ ] 添加导出为PDF功能
- [ ] 支持更多文件格式

## 许可证

MIT

---

希望你喜欢这个简单而功能强大的白板工具！欢迎贡献和反馈。 